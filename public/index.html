<!DOCTYPE html>
<html>
	<head charset="utf-8">
		<title>WonderBar</title>
		<link href="css/style.css" rel="stylesheet"/>
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
	</head>
	<body>
	<div id="header">
		<h2>wunderbar</h2>
	</div>
	<div id="container">
		<div id="maincontent">
			<div id="addIngrident">
				<h1>Select your ingridents</h1>
				<input type="text" id="selectIng" class="ui-autocomplete-input">
				</input>
				<a href="#" id="addButton">Add ingridient</a>
			</div>
			<div id="selectedIngridents">
				<ul id="ingridentsList">
					
				<ul>
			</div>
			<a href="#" id="searchButton">Find drinks</a> 
			<div id="drinkResult">
				<h1>You can make</h1>
				<ul id="drinkList">
				</ul>
			</div>	
		</div>

	</div>

	<script src="lib/jquery-1.8.2.min.js"></script>
	<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
	</body>	

	<script>	
	var ingridientsMap; 
	$(function() {
		var ingridients = [];
		$.getJSON('/ingredients', function(data) {
		   ingridientsMap = data; 
		   $.each(data, function(i, item){
		   		ingridients.push(item.ingredient);
	        });
		});
	    $("#selectIng").autocomplete({
	      source: ingridients
	    });
	   });
	var ingredientCounter = 0; 

	var ingMapper = function(ingridentName){
		var id = null; 
		 $.each(ingridientsMap, function(i, item){
		   		if(item.ingredient == ingridentName){
		   			id = item;
		   		}
	     });
	     return id; 
	};

	var selectedIngridents = []; 

	var searchForIngredient = function () {
		var jsonString = JSON.stringify(selectedIngridents);
		$.ajax({
		  type: "POST",
		  url: "drinks",
		  data:jsonString,
		  dataType: "json",
		  contentType: "application/json; charset=utf-8"
		}).done(function( data ) {
		 	$.each(data, function(i, item){
		   		$("#drinkList").append('<li>'+ item[0].drink+'</li>');
	        });
		});
	}

	var addIngredient = function () {
		var ingName = $('input[id=selectIng]').val();
		$("#ingridentsList").append('<li><span>'+ingName+'<span><span class="remove-icon"><a herf="#">x</a></span></li>');
		var ingId = ingMapper(ingName);
		if(ingId !=null){
			selectedIngridents.push(ingId);
		}
		ingredientCounter =ingredientCounter+1; 
		if(ingredientCounter>3)
			alert("Du har valgt fler enn tre ingridinser");
		 return false;
	};
	$("#addButton").click(addIngredient);
	var ingredientCounter = 0; 
	
	$("#searchButton").click(searchForIngredient); 

	</script>
<html>